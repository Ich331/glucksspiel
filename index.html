<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gewinnspiel (Browser)</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --good:#16a34a; --bad:#ef4444; --player:#2563eb; --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071025 0%,#051226 100%);color:#e6eef6}
    .container{max-width:980px;margin:28px auto;padding:24px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .meta{margin-left:auto;text-align:right}
    .meta .coins{font-weight:700;color:var(--accent)}
    .controls{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    .controls input[type=number]{width:88px;padding:8px;border-radius:8px;border:1px solid #142433;background:var(--card);color:inherit}
    .controls button{background:var(--accent);border:none;color:#012; padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .controls button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
    .board{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;background:var(--glass);padding:14px;border-radius:10px;width:520px;margin:0 auto}
    .cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;border-radius:8px;background:linear-gradient(180deg,#071026 0%,#08172a 100%);cursor:pointer;user-select:none;border:1px solid rgba(255,255,255,0.03);position:relative;transition:transform .12s ease, box-shadow .12s ease}
    .cell:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .cell .num{position:absolute;top:8px;left:10px;font-size:12px;color:var(--muted)}
    .cell .mark{font-size:36px;line-height:1;font-weight:700}
    .cell.empty{background:linear-gradient(180deg,#081226,#071126)}
    .cell.player{background:linear-gradient(180deg,#0f2b6b,#0b254f);box-shadow:0 6px 18px rgba(37,99,235,0.12)}
    .cell.comp{background:linear-gradient(180deg,#3b0f19,#2b0b12);box-shadow:0 6px 18px rgba(239,68,68,0.08)}
    .cell.comp-win{background:linear-gradient(180deg,#083916,#052b0f);box-shadow:0 6px 18px rgba(22,163,74,0.08)}
    .legend{display:flex;gap:10px;align-items:center;margin-top:12px}
    .legend .item{display:flex;gap:8px;align-items:center;color:var(--muted)}
    .legend .dot{width:14px;height:14px;border-radius:4px}
    .msg{margin-top:12px;color:var(--muted);min-height:20px}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    .btn{Padding:8px 12px;border-radius:8px;border:none;background:#0ea5a3;color:#012;cursor:pointer;font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    /* Icons & animations */
    .mark svg{width:42px;height:42px;display:block}
    .cell.animate-pop{animation:pop .26s ease forwards}
    @keyframes pop{0%{transform:scale(0.85);opacity:0.0}50%{transform:scale(1.05);opacity:1}100%{transform:scale(1);opacity:1}}
    .cell.highlight{box-shadow:0 8px 28px rgba(8,200,150,0.14);outline:2px solid rgba(8,200,150,0.08);animation:pulse 1.1s ease-in-out infinite}
    @keyframes pulse{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

    /* Responsive / touch friendly */
    @media (max-width:720px){
      .container{margin:12px;padding:16px;border-radius:10px}
      .controls{flex-wrap:wrap;gap:8px}
      .controls input[type=number]{width:72px}
      .controls button{padding:10px 14px;font-size:15px}
      .board{width:100%;gap:8px;padding:10px}
      .cell{border-radius:10px;font-size:18px}
      .cell .mark{font-size:28px}
      .cell .num{top:6px;left:8px;font-size:11px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Gewinnspiel — Browser Version</h1>
        <div class="small">Klicke Felder, kaufe Felder (5 coins / Feld). Computer zieht 8 Zahlen.</div>
      </div>
      <div class="meta">
        <div class="small">Deine Coins</div>
        <div class="coins" id="coins">50</div>
      </div>
    </header>

    <div class="controls">
      <div class="small">Wähle beliebig viele Felder durch Anklicken. Klicke danach auf "Bestätigen & Ziehen".</div>
      <button id="confirmSelection">Bestätigen & Ziehen</button>
      <button id="clearSelection" class="secondary">Auswahl löschen</button>
      <button id="resetBtn" class="secondary">Neustart</button>
      <button id="nextBtn" class="secondary" style="display:none">Weiter</button>
    </div>

    <div class="board" id="board"></div>

    <div class="legend">
      <div class="item"><div class="dot" style="background:var(--player)"></div> Spieler (X)</div>
      <div class="item"><div class="dot" style="background:var(--bad)"></div> Computer (O)</div>
      <div class="item"><div class="dot" style="background:var(--good)"></div> Computer + Spieler Treffer</div>
    </div>

    <div class="msg" id="message">Spiel startet mit 50 coins.</div>

    <footer>
      <div class="small">Treffer: +10 coins pro getroffenes Feld</div>
      <div class="small">Jackpots: 4 O -> 40 * (#X in Linie) | 5 O -> 100 * (#X in Linie)</div>
    </footer>
  </div>

  <script>
    // Clean, working implementation of the game logic.
    const START_COINS = 50;
    const COST_PER_FIELD = 5;
    const DRAW_COUNT = 8; // wie im Python-Code
    let coins = START_COINS;

    // Board as objects with status: 'free'|'player'|'comp'|'comp-win'
    const board = [];
    const boardEl = document.getElementById('board');
    const coinsEl = document.getElementById('coins');
    const messageEl = document.getElementById('message');

    const confirmBtn = document.getElementById('confirmSelection');
    const clearBtn = document.getElementById('clearSelection');
    const resetBtn = document.getElementById('resetBtn');
    const nextBtn = document.getElementById('nextBtn');

    let selecting = true; // player may select fields

    function initBoard(){
      board.length = 0;
      for(let i=1;i<=25;i++) board.push({n:i, status:'free', matched:false});
      renderBoard();
    }

    function renderBoard(){
      boardEl.innerHTML = '';
      board.forEach((cell, idx) => {
        const el = document.createElement('div');
        el.className = 'cell ' + (cell.status === 'free' ? 'empty' : cell.status);
        el.dataset.index = idx;

        const num = document.createElement('div'); num.className='num'; num.textContent = cell.n;
        const mark = document.createElement('div'); mark.className='mark';

        if(cell.status === 'player'){
          mark.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><g stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M4 4l16 16"></path><path d="M20 4L4 20"></path></g></svg>`;
        } else if(cell.status === 'comp' || cell.status === 'comp-win'){
          mark.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="7" fill="none" stroke="white" stroke-width="2"/></svg>`;
        } else {
          mark.innerHTML = '';
        }

        el.appendChild(num); el.appendChild(mark);
        el.addEventListener('click', ()=> onCellClick(idx));
        boardEl.appendChild(el);
      });
    }

    function onCellClick(idx){
      if(!selecting){ showMessage('Runde läuft — warte bis der Computer gezogen hat.'); return; }
      const cell = board[idx];
      if(cell.status === 'free') cell.status = 'player';
      else if(cell.status === 'player') cell.status = 'free';
      renderBoard();
    }

    function getPlayerCount(){ return board.filter(c => c.status === 'player').length; }
    function showMessage(txt){ messageEl.textContent = txt; }
    function updateCoins(){ coinsEl.textContent = coins; }

    confirmBtn.addEventListener('click', ()=>{
      if(!selecting){ showMessage('Warte bis die Runde vorbei ist.'); return; }
      const selected = getPlayerCount();
      if(selected === 0){ showMessage('Wähle mindestens ein Feld bevor du bestätigst.'); return; }
      const cost = selected * COST_PER_FIELD;
      if(cost > coins){ showMessage(`Nicht genug coins. Du hast ${coins}, benötigst ${cost}.`); return; }

      // pay and lock
      coins -= cost; updateCoins(); selecting = false; renderBoard();
      showMessage('Auswahl bestätigt — der Computer zieht...');

      // draw
      const pool = Array.from({length:25},(_,i)=>i+1);
      const drawn = sample(pool, DRAW_COUNT);
      const drawnIndices = [];
      drawn.forEach(num => {
        const idx = num - 1; drawnIndices.push(idx);
        const cell = board[idx];
        if(cell.status === 'player'){ coins += 10; cell.status = 'comp-win'; cell.matched = true; }
        else if(cell.status === 'free'){ cell.status = 'comp'; }
      });

      updateCoins(); renderBoard();

      // animate drawn
      drawnIndices.forEach(i => {
        const el = boardEl.querySelector(`[data-index='${i}']`);
        if(el){ el.classList.add('animate-pop'); setTimeout(()=>el.classList.remove('animate-pop'), 420); }
      });

      showMessage('Der Computer hat gezogen: ' + drawn.join(', '));
      jackpotPruefen();

      // Show the 'Weiter' button and wait for user to continue
      nextBtn.style.display = 'inline-block';
      nextBtn.disabled = false;
    });

    clearBtn.addEventListener('click', ()=>{
      board.forEach(c => { if(c.status === 'player') c.status = 'free'; }); renderBoard(); showMessage('Auswahl gelöscht.');
    });

    resetBtn.addEventListener('click', ()=>{
      coins = START_COINS; updateCoins(); initBoard(); selecting = true; showMessage('Neues Spiel gestartet.');
    });

    // Continue to next round: hide button, reset board and allow selection
    nextBtn.addEventListener('click', ()=>{
      nextBtn.style.display = 'none';
      initBoard(); selecting = true; showMessage('Neue Runde: Wähle Felder und bestätige.');
    });

    function sample(arr, k){ const copy = arr.slice(); const out = []; for(let i=0;i<k && copy.length;i++){ const j = Math.floor(Math.random()*copy.length); out.push(copy.splice(j,1)[0]); } return out; }

    function jackpotPruefen(){
      const lines = [
        [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],
        [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],
        [0,6,12,18,24],[4,8,12,16,20]
      ];

      function is_computer(cell){ return cell && (cell.status === 'comp' || cell.status === 'comp-win'); }
      function is_player(cell){ return cell && (cell.status === 'player'); }

      const usedPlayerIndices = new Set();
      const payoutTable = {4:40,5:100};

      lines.forEach(line => {
        const comp_count = line.reduce((s,i)=> s + (is_computer(board[i])?1:0), 0);
        const playerIndices = line.filter(i => is_player(board[i]) && !usedPlayerIndices.has(i));
        const player_in_line = playerIndices.length;
        if(player_in_line > 0 && payoutTable[comp_count]){
          const multiplier = payoutTable[comp_count];
          const gain = multiplier * player_in_line;
          coins += gain; updateCoins();
          const label = comp_count === 5 ? 'Super Jackpot' : (comp_count === 4 ? 'Jackpot' : `Jackpot (${comp_count} O)`);
          showMessage((messageEl.textContent || '') + `\n${label}! Du hast ${gain} coins gewonnen!`);
          playerIndices.forEach(i => usedPlayerIndices.add(i));
          highlightLine(line);
        }
      });
    }

    function highlightLine(line){
      line.forEach(i => { const el = boardEl.querySelector(`[data-index='${i}']`); if(el) el.classList.add('highlight'); });
      setTimeout(()=>{ line.forEach(i => { const el = boardEl.querySelector(`[data-index='${i}']`); if(el) el.classList.remove('highlight'); }); }, 1600);
    }

    // init
    initBoard(); updateCoins();
  </script>
</body>
</html>